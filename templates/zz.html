<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reservar Cita Médica</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Fuentes más legibles para personas mayores */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        /* Animaciones suaves */
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s ease;
        }
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        
        .slide-up-enter-active, .slide-up-leave-active {
            transition: all 0.4s ease;
        }
        .slide-up-enter-from, .slide-up-leave-to {
            opacity: 0;
            transform: translateY(20px);
        }
        
        /* Efectos táctiles suaves */
        .btn-primary {
            transition: all 0.2s ease;
        }
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        /* Mejoras para accesibilidad */
        .focus-ring:focus {
            outline: 3px solid #3B82F6;
            outline-offset: 2px;
        }
        
        /* Teclado virtual mejorado */
        .key-button {
            min-height: 60px;
            font-size: 1.25rem;
            font-weight: 600;
            transition: all 0.15s ease;
        }
        .key-button:active {
            transform: scale(0.95);
        }
        
        /* Horarios grid responsive */
        .time-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }
        
        /* Indicadores de estado mejorados */
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        /* Cards con bordes suaves */
        .card {
            background: white;
            border: 2px solid #E5E7EB;
            border-radius: 16px;
            padding: 24px;
        }
        
        .card-active {
            border-color: #3B82F6;
            background: #F8FAFF;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="app">
        <div class="container mx-auto max-w-8xl px-4 py-6">
            <!-- Header Principal -->
            <header class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-3">
                    <i class="fas fa-stethoscope text-blue-600 mr-3"></i>
                    Reservar Cita Médica Particular
                </h1>
                <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                    Complete los siguientes pasos para programar su cita médica
                </p>
            </header>

            <!-- Indicador de Progreso -->
            <div class="mb-8">
                <div class="flex justify-center items-center space-x-6 md:space-x-12">
                    <div class="flex items-center">
                        <div :class="[
                            'w-12 h-12 rounded-full flex items-center justify-center text-white text-lg font-bold transition-all',
                            idPaciente ? 'bg-green-500' : (nroDocumento.length >= 8 ? 'bg-blue-500' : 'bg-gray-300')
                        ]">
                            <i v-if="idPaciente" class="fas fa-check"></i>
                            <span v-else>1</span>
                        </div>
                        <span class="ml-3 text-base font-medium text-gray-700">Paciente</span>
                    </div>
                    
                    <div class="h-1 w-12 md:w-20 bg-gray-200 rounded">
                        <div :class="[
                            'h-full bg-blue-500 rounded transition-all duration-500',
                            servicioSeleccionado && medicoSeleccionado ? 'w-full' : 'w-0'
                        ]"></div>
                    </div>
                    
                    <div class="flex items-center">
                        <div :class="[
                            'w-12 h-12 rounded-full flex items-center justify-center text-white text-lg font-bold transition-all',
                            (servicioSeleccionado && medicoSeleccionado) ? 'bg-green-500' : 'bg-gray-300'
                        ]">
                            <i v-if="servicioSeleccionado && medicoSeleccionado" class="fas fa-check"></i>
                            <span v-else>2</span>
                        </div>
                        <span class="ml-3 text-base font-medium text-gray-700">Especialidad</span>
                    </div>
                    
                    <div class="h-1 w-12 md:w-20 bg-gray-200 rounded">
                        <div :class="[
                            'h-full bg-blue-500 rounded transition-all duration-500',
                            horarioSeleccionado ? 'w-full' : 'w-0'
                        ]"></div>
                    </div>
                    
                    <div class="flex items-center">
                        <div :class="[
                            'w-12 h-12 rounded-full flex items-center justify-center text-white text-lg font-bold transition-all',
                            horarioSeleccionado ? 'bg-green-500' : 'bg-gray-300'
                        ]">
                            <i v-if="horarioSeleccionado" class="fas fa-check"></i>
                            <span v-else>3</span>
                        </div>
                        <span class="ml-3 text-base font-medium text-gray-700">Horario</span>
                    </div>
                </div>
            </div>

            <!-- Contenido Principal -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                
                <!-- Paso 1: Datos del Paciente -->
                <div class="lg:col-span-4">
                    <div :class="['card transition-all', idPaciente ? 'card-active' : '']">
                        <div class="flex items-center mb-6">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-user text-blue-600 text-lg"></i>
                            </div>
                            <h2 class="text-xl font-semibold text-gray-900">Datos del Paciente</h2>
                        </div>

                        <!-- Display del Documento -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-3">
                                Número de Documento (DNI/CE)
                            </label>
                            
                            <div :class="[
                                'relative border-2 rounded-xl p-4 min-h-[70px] flex items-center justify-center transition-all',
                                errorPaciente ? 'border-red-400 bg-red-50' : 
                                idPaciente ? 'border-green-400 bg-green-50' : 
                                'border-gray-300 bg-gray-50'
                            ]">
                                <div class="text-center">
                                    <div v-if="!nroDocumento" class="text-gray-400 text-lg">
                                        Ingrese documento
                                    </div>
                                    <div v-else class="text-2xl font-mono font-bold text-gray-900">
                                        {{ nroDocumentoFormateado }}
                                    </div>
                                    <div v-if="nroDocumento && nroDocumento.length < 8" class="text-sm text-gray-500 mt-1">
                                        {{ nroDocumento.length }}/8 dígitos mínimo
                                    </div>
                                </div>
                                
                                <!-- Indicador de estado -->
                                <div v-if="idPaciente" class="absolute top-2 right-2">
                                    <div class="w-6 h-6 bg-green-500 rounded-full flex items-center justify-center">
                                        <i class="fas fa-check text-white text-xs"></i>
                                    </div>
                                </div>
                                
                                <div v-else-if="buscandoPaciente" class="absolute top-2 right-2">
                                    <div class="w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center">
                                        <i class="fas fa-spinner fa-spin text-white text-xs"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Teclado Virtual Mejorado -->
                        <div v-if="!idPaciente" class="bg-white border-2 border-gray-200 rounded-xl p-4">
                            <div class="grid grid-cols-3 gap-3 mb-4">
                                <button
                                    v-for="num in [1,2,3,4,5,6,7,8,9]"
                                    :key="num"
                                    :disabled="nroDocumento.length >= 12"
                                    @click="agregarNumero(num)"
                                    :class="[
                                        'key-button bg-gray-50 border-2 border-gray-200 rounded-lg hover:bg-gray-100 hover:border-gray-300 focus-ring',
                                        nroDocumento.length >= 12 ? 'opacity-50 cursor-not-allowed' : 'active:bg-gray-200'
                                    ]"
                                >
                                    {{ num }}
                                </button>
                            </div>
                            
                            <div class="grid grid-cols-3 gap-3">
                                <button
                                    @click="limpiarUltimo"
                                    class="key-button bg-red-50 border-2 border-red-200 rounded-lg text-red-600 hover:bg-red-100 hover:border-red-300 focus-ring"
                                >
                                    <i class="fas fa-backspace"></i>
                                </button>
                                
                                <button
                                    :disabled="nroDocumento.length >= 12"
                                    @click="agregarNumero(0)"
                                    :class="[
                                        'key-button bg-gray-50 border-2 border-gray-200 rounded-lg hover:bg-gray-100 hover:border-gray-300 focus-ring',
                                        nroDocumento.length >= 12 ? 'opacity-50 cursor-not-allowed' : 'active:bg-gray-200'
                                    ]"
                                >
                                    0
                                </button>
                                
                                <button
                                    @click="buscarPaciente"
                                    :disabled="nroDocumento.length < 8 || buscandoPaciente"
                                    :class="[
                                        'key-button rounded-lg focus-ring font-medium transition-all',
                                        (nroDocumento.length >= 8 && !buscandoPaciente) 
                                            ? 'bg-blue-600 text-white border-2 border-blue-600 hover:bg-blue-700' 
                                            : 'bg-gray-200 text-gray-500 border-2 border-gray-200 cursor-not-allowed'
                                    ]"
                                >
                                    <i v-if="!buscandoPaciente" class="fas fa-search"></i>
                                    <i v-else class="fas fa-spinner fa-spin"></i>
                                </button>
                            </div>
                            
                            <div class="mt-4 flex justify-between">
                                <button
                                    @click="limpiarTodo"
                                    class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg hover:bg-gray-50"
                                >
                                    <i class="fas fa-trash-alt mr-2"></i>
                                    Limpiar
                                </button>
                            </div>
                        </div>

                        <!-- Error del paciente -->
                        <transition name="fade">
                            <div v-if="errorPaciente" class="mt-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                                <div class="flex items-center text-red-700">
                                    <i class="fas fa-exclamation-triangle mr-2"></i>
                                    <span class="text-sm">{{ errorPaciente }}</span>
                                </div>
                            </div>
                        </transition>

                        <!-- Información del paciente encontrado -->
                        <transition name="slide-up">
                            <div v-if="idPaciente" class="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-user-check text-green-600 mr-2"></i>
                                    <h4 class="font-medium text-green-800">Paciente Encontrado</h4>
                                </div>
                                <div class="text-sm text-green-700 space-y-1">
                                    <p><strong>Documento:</strong> {{ nroDocumentoFormateado }}</p>
                                    <p><strong>Nombre:</strong> {{ nombrePaciente }}</p>
                                </div>
                            </div>
                        </transition>
                    </div>
                </div>

                <!-- Paso 2: Fecha y Especialidad -->
                <div class="lg:col-span-4">
                    <div :class="['card transition-all', (servicioSeleccionado && medicoSeleccionado) ? 'card-active' : '']">
                        <div class="flex items-center mb-6">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-calendar-plus text-blue-600 text-lg"></i>
                            </div>
                            <h2 class="text-xl font-semibold text-gray-900">Fecha y Especialidad</h2>
                        </div>

                        <!-- Selección de fecha -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-3">
                                Seleccionar Fecha
                            </label>
                            <div class="grid grid-cols-4 md:grid-cols-7 gap-2">
                                <button
                                    v-for="dia in diasSemana"
                                    :key="dia.fecha"
                                    :disabled="!dia.activo"
                                    @click="seleccionarFecha(dia.fecha)"
                                    :class="[
                                        'p-3 border-2 rounded-xl text-center transition-all min-h-[70px] focus-ring',
                                        fechaCita === dia.fecha && dia.activo 
                                            ? 'border-blue-500 bg-blue-50 text-blue-700' 
                                            : dia.activo 
                                                ? 'border-gray-200 bg-white hover:border-blue-300 hover:bg-blue-50'
                                                : 'border-gray-200 bg-gray-100 text-gray-400 cursor-not-allowed'
                                    ]"
                                >
                                    <div class="text-xs font-medium">{{ dia.dia }}</div>
                                    <div class="text-lg font-bold">{{ dia.numero }}</div>
                                    <div v-if="dia.esHoy" class="text-xs text-blue-600 font-medium">Hoy</div>
                                </button>
                            </div>
                        </div>

                        <!-- Especialidad -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-3">
                                Especialidad Médica
                            </label>
                            <div class="relative">
                                <select
                                    v-model="servicioSeleccionado"
                                    @change="buscarMedicos"
                                    :disabled="!serviciosDisponibles.length || !fechaCita"
                                    class="w-full pl-12 pr-10 py-4 text-base border-2 border-gray-300 rounded-xl bg-white focus:outline-none focus:border-blue-500 focus-ring appearance-none"
                                >
                                    <option value="">
                                        {{ !serviciosDisponibles.length ? "No hay especialidades disponibles" : "Seleccione especialidad" }}
                                    </option>
                                    <option v-for="servicio in serviciosDisponibles" :key="servicio.IdServicio" :value="servicio.IdServicio">
                                        {{ servicio.Nombre }}
                                    </option>
                                </select>
                                <i class="fas fa-heartbeat absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <i class="fas fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>

                        <!-- Médico -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">
                                Médico Especialista
                            </label>
                            <div class="relative">
                                <select
                                    v-model="medicoSeleccionado"
                                    @change="buscarHorarios"
                                    :disabled="!medicosDisponibles.length"
                                    class="w-full pl-12 pr-10 py-4 text-base border-2 border-gray-300 rounded-xl bg-white focus:outline-none focus:border-blue-500 focus-ring appearance-none"
                                >
                                    <option value="">
                                        {{ !medicosDisponibles.length ? "No hay médicos disponibles" : "Seleccione médico" }}
                                    </option>
                                    <option v-for="medico in medicosDisponibles" :key="medico.idMedico" :value="medico.idMedico">
                                        Dr. {{ medico.nombre }}
                                    </option>
                                </select>
                                <i class="fas fa-user-doctor absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <i class="fas fa-chevron-down absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Paso 3: Horarios -->
                <div class="lg:col-span-4">
                    <div :class="['card transition-all', horarioSeleccionado ? 'card-active' : '']">
                        <div class="flex items-center mb-6">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-clock text-blue-600 text-lg"></i>
                            </div>
                            <div>
                                <h2 class="text-xl font-semibold text-gray-900">Horarios Disponibles</h2>
                                <p v-if="fechaCita" class="text-sm text-gray-500">{{ formatearFecha(fechaCita) }}</p>
                            </div>
                        </div>

                        <!-- Pestañas de turno -->
                        <div class="mb-6">
                            <div class="flex bg-gray-100 rounded-lg p-1">
                                <button
                                    @click="turnoActivo = 'mañana'"
                                    :class="[
                                        'flex-1 py-3 px-4 rounded-md font-medium transition-all focus-ring',
                                        turnoActivo === 'mañana'
                                            ? 'bg-white text-blue-600 shadow-sm'
                                            : 'text-gray-600 hover:text-gray-800'
                                    ]"
                                >
                                    <i class="fas fa-sun mr-2"></i>
                                    Mañana
                                </button>
                                <button
                                    @click="turnoActivo = 'tarde'"
                                    :class="[
                                        'flex-1 py-3 px-4 rounded-md font-medium transition-all focus-ring',
                                        turnoActivo === 'tarde'
                                            ? 'bg-white text-blue-600 shadow-sm'
                                            : 'text-gray-600 hover:text-gray-800'
                                    ]"
                                >
                                    <i class="fas fa-moon mr-2"></i>
                                    Tarde
                                </button>
                            </div>
                        </div>

                        <!-- Grid de horarios -->
                        <div class="min-h-[250px]">
                            <transition name="fade" mode="out-in">
                                <div v-if="cargandoHorarios" class="flex items-center justify-center py-16">
                                    <div class="text-center">
                                        <i class="fas fa-spinner fa-spin text-3xl text-blue-500 mb-3"></i>
                                        <p class="text-gray-500">Cargando horarios...</p>
                                    </div>
                                </div>
                                
                                <div v-else-if="!horariosDisponibles.length" class="flex items-center justify-center py-16">
                                    <div class="text-center">
                                        <i class="fas fa-calendar-times text-3xl text-gray-300 mb-3"></i>
                                        <p class="text-gray-500">
                                            {{ !medicoSeleccionado ? 'Seleccione un médico' : 'No hay horarios disponibles' }}
                                        </p>
                                    </div>
                                </div>
                                
                                <div v-else class="time-grid">
                                    <button
                                        v-for="horario in horariosFiltrados"
                                        :key="horario.hora"
                                        @click="seleccionarHorario(horario.hora)"
                                        :class="[
                                            'py-4 px-3 text-base font-medium border-2 rounded-xl transition-all focus-ring btn-primary',
                                            horarioSeleccionado === horario.hora
                                                ? 'border-blue-500 bg-blue-50 text-blue-700'
                                                : 'border-gray-200 bg-white hover:border-blue-300 hover:bg-blue-50'
                                        ]"
                                    >
                                        {{ formatHora(horario.hora) }}
                                    </button>
                                </div>
                            </transition>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resumen de la Cita -->
            <transition name="slide-up">
                <div v-if="mostrarResumen" class="mt-8 card border-green-200 bg-green-50">
                    <div class="flex items-center mb-4">
                        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-clipboard-check text-green-600 text-lg"></i>
                        </div>
                        <h3 class="text-xl font-semibold text-green-800">Resumen de su Cita</h3>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="bg-white rounded-lg p-4 border border-green-200">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-user text-green-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-600">Paciente</span>
                            </div>
                            <p class="font-semibold text-gray-900">{{ nombrePaciente }}</p>
                            <p class="text-sm text-gray-600">{{ nroDocumentoFormateado }}</p>
                        </div>
                        
                        <div class="bg-white rounded-lg p-4 border border-green-200">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-calendar text-green-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-600">Fecha</span>
                            </div>
                            <p class="font-semibold text-gray-900">{{ formatearFecha(fechaCita) }}</p>
                        </div>
                        
                        <div class="bg-white rounded-lg p-4 border border-green-200">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-heartbeat text-green-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-600">Especialidad</span>
                            </div>
                            <p class="font-semibold text-gray-900">{{ nombreEspecialidadSeleccionada }}</p>
                        </div>
                        
                        <div class="bg-white rounded-lg p-4 border border-green-200">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-clock text-green-600 mr-2"></i>
                                <span class="text-sm font-medium text-gray-600">Horario</span>
                            </div>
                            <p class="font-semibold text-gray-900">{{ formatHora(horarioSeleccionado) }}</p>
                        </div>
                    </div>
                </div>
            </transition>

            <!-- Botones de Acción -->
            <div class="mt-8 flex flex-col sm:flex-row gap-4">
                <button
                    @click="limpiarFormulario"
                    class="flex-1 py-4 px-6 border-2 border-gray-300 rounded-xl text-base font-medium text-gray-700 bg-white hover:bg-gray-50 transition-all focus-ring btn-primary"
                >
                    <i class="fas fa-times mr-2"></i>
                    Cancelar y Limpiar
                </button>
                
                <button
                    @click="confirmarCita"
                    :disabled="!mostrarResumen || cargando"
                    :class="[
                        'flex-1 py-4 px-6 rounded-xl text-base font-medium transition-all focus-ring btn-primary',
                        (!mostrarResumen || cargando)
                            ? 'bg-gray-300 text-gray-500 cursor-not-allowed border-2 border-gray-300'
                            : 'bg-blue-600 text-white hover:bg-blue-700 border-2 border-blue-600'
                    ]"
                >
                    <template v-if="!cargando">
                        <i class="fas fa-check-circle mr-2"></i>
                        Confirmar Cita Médica
                    </template>
                    <template v-else>
                        <i class="fas fa-spinner fa-spin mr-2"></i>
                        Procesando...
                    </template>
                </button>
            </div>
        </div>

        <!-- Notificación de Éxito -->
        <transition name="slide-up">
            <div v-if="mostrarNotificacion" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                <div class="bg-white rounded-2xl p-8 max-w-md mx-4 text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check-circle text-green-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">¡Cita Registrada!</h3>
                    <p class="text-gray-600 mb-6">Su cita médica ha sido programada exitosamente.</p>
                    <button
                        @click="cerrarNotificacion"
                        class="w-full py-3 px-6 bg-green-600 text-white rounded-xl font-medium hover:bg-green-700 transition-all"
                    >
                        Entendido
                    </button>
                </div>
            </div>
        </transition>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                // Estados del formulario
                const nroDocumento = ref('');
                const idPaciente = ref(null);
                const nombrePaciente = ref('');
                const fechaCita = ref('');
                const servicioSeleccionado = ref('');
                const medicoSeleccionado = ref('');
                const horarioSeleccionado = ref('');
                const turnoActivo = ref('mañana');

                // Estados de carga
                const buscandoPaciente = ref(false);
                const cargandoHorarios = ref(false);
                const cargando = ref(false);

                // Estados de error
                const errorPaciente = ref('');

                // Estados de UI
                const mostrarNotificacion = ref(false);

                // Datos simulados
                const serviciosDisponibles = ref([
                    { IdServicio: 1, Nombre: 'Cardiología' },
                    { IdServicio: 2, Nombre: 'Neurología' },
                    { IdServicio: 3, Nombre: 'Dermatología' }
                ]);

                const medicosDisponibles = ref([
                    { idMedico: 1, nombre: 'García Pérez, Juan Carlos' },
                    { idMedico: 2, nombre: 'López Silva, María Elena' }
                ]);

                const horariosDisponibles = ref([
                    { hora: '09:00' }, { hora: '09:30' }, { hora: '10:00' }, { hora: '10:30' },
                    { hora: '11:00' }, { hora: '11:30' }, { hora: '12:00' }, { hora: '14:00' },
                    { hora: '14:30' }, { hora: '15:00' }, { hora: '15:30' }, { hora: '16:00' },
                    { hora: '16:30' }, { hora: '17:00' }
                ]);

                // Computed properties
                const nroDocumentoFormateado = computed(() => {
                    if (!nroDocumento.value) return '';
                    const doc = nroDocumento.value;
                    if (doc.length <= 8) {
                        return doc.replace(/(\d{2})(\d{3})(\d{3})/, '$1.$2.$3');
                    } else {
                        return doc.replace(/(\d{2})(\d{3})(\d{3})(\d+)/, '$1.$2.$3.$4');
                    }
                });

                const diasSemana = computed(() => {
                    const dias = [];
                    const hoy = new Date();
                    const diasNombres = ['Dom', 'Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb'];

                    for (let i = 0; i < 7; i++) {
                        const fecha = new Date(hoy);
                        fecha.setDate(hoy.getDate() + i);
                        
                        const fechaStr = fecha.toISOString().split('T')[0];
                        const esDomingo = fecha.getDay() === 0;
                        
                        dias.push({
                            fecha: fechaStr,
                            dia: diasNombres[fecha.getDay()],
                            numero: fecha.getDate(),
                            activo: !esDomingo,
                            esHoy: i === 0
                        });
                    }
                    return dias;
                });

                const horariosFiltrados = computed(() => {
                    return horariosDisponibles.value.filter(horario => {
                        const hora = parseInt(horario.hora.split(':')[0]);
                        if (turnoActivo.value === 'mañana') {
                            return hora >= 8 && hora < 14;
                        } else {
                            return hora >= 14 && hora < 18;
                        }
                    });
                });

                const nombreEspecialidadSeleccionada = computed(() => {
                    const servicio = serviciosDisponibles.value.find(s => s.IdServicio == servicioSeleccionado.value);
                    return servicio ? servicio.Nombre : '';
                });

                const mostrarResumen = computed(() => {
                    return idPaciente.value && fechaCita.value && servicioSeleccionado.value && 
                           medicoSeleccionado.value && horarioSeleccionado.value;
                });

                // Métodos del teclado
                const agregarNumero = (num) => {
                    if (nroDocumento.value.length < 12) {
                        nroDocumento.value += num.toString();
                    }
                };

                const limpiarUltimo = () => {
                    if (nroDocumento.value.length > 0) {
                        nroDocumento.value = nroDocumento.value.slice(0, -1);
                        if (nroDocumento.value.length < 8) {
                            limpiarDatosPaciente();
                        }
                    }
                };

                const limpiarTodo = () => {
                    nroDocumento.value = '';
                    limpiarDatosPaciente();
                };

                const limpiarDatosPaciente = () => {
                    idPaciente.value = null;
                    nombrePaciente.value = '';
                    errorPaciente.value = '';
                };

                // Métodos de búsqueda
                const buscarPaciente = async () => {
                    if (nroDocumento.value.length < 8) {
                        errorPaciente.value = 'Ingrese al menos 8 dígitos';
                        return;
                    }

                    buscandoPaciente.value = true;
                    errorPaciente.value = '';

                    try {
                        // Simulación de búsqueda
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                        // Simulación de datos encontrados
                        if (nroDocumento.value === '12345678' || nroDocumento.value === '87654321') {
                            idPaciente.value = 1;
                            nombrePaciente.value = 'PÉREZ GARCÍA, JUAN CARLOS';
                        } else {
                            errorPaciente.value = 'No se encontró paciente con este documento';
                        }
                    } catch (error) {
                        errorPaciente.value = 'Error al buscar paciente';
                    } finally {
                        buscandoPaciente.value = false;
                    }
                };

                const buscarMedicos = () => {
                    medicoSeleccionado.value = '';
                    horarioSeleccionado.value = '';
                };

                const buscarHorarios = () => {
                    cargandoHorarios.value = true;
                    horarioSeleccionado.value = '';
                    
                    setTimeout(() => {
                        cargandoHorarios.value = false;
                    }, 1000);
                };

                // Métodos de selección
                const seleccionarFecha = (fecha) => {
                    fechaCita.value = fecha;
                    servicioSeleccionado.value = '';
                    medicoSeleccionado.value = '';
                    horarioSeleccionado.value = '';
                };

                const seleccionarHorario = (hora) => {
                    horarioSeleccionado.value = hora;
                };

                // Métodos de formato
                const formatearFecha = (fecha) => {
                    if (!fecha) return '';
                    const date = new Date(fecha + 'T00:00:00');
                    return date.toLocaleDateString('es-ES', { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    });
                };

                const formatHora = (hora) => {
                    if (!hora) return '';
                    const [h, m] = hora.split(':');
                    const hour = parseInt(h);
                    const period = hour >= 12 ? 'PM' : 'AM';
                    const hour12 = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
                    return `${hour12}:${m} ${period}`;
                };

                // Métodos de acción
                const confirmarCita = async () => {
                    if (!mostrarResumen.value) return;

                    cargando.value = true;
                    
                    try {
                        // Simulación de registro
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                        mostrarNotificacion.value = true;
                        
                        // Limpiar formulario después de un delay
                        setTimeout(() => {
                            limpiarFormulario();
                        }, 3000);
                        
                    } catch (error) {
                        console.error('Error al registrar cita:', error);
                    } finally {
                        cargando.value = false;
                    }
                };

                const limpiarFormulario = () => {
                    nroDocumento.value = '';
                    idPaciente.value = null;
                    nombrePaciente.value = '';
                    fechaCita.value = '';
                    servicioSeleccionado.value = '';
                    medicoSeleccionado.value = '';
                    horarioSeleccionado.value = '';
                    errorPaciente.value = '';
                    turnoActivo.value = 'mañana';
                };

                const cerrarNotificacion = () => {
                    mostrarNotificacion.value = false;
                };

                // Inicialización
                onMounted(() => {
                    // Establecer fecha actual como default
                    const hoy = new Date().toISOString().split('T')[0];
                    fechaCita.value = hoy;
                });

                return {
                    // Estados
                    nroDocumento,
                    idPaciente,
                    nombrePaciente,
                    fechaCita,
                    servicioSeleccionado,
                    medicoSeleccionado,
                    horarioSeleccionado,
                    turnoActivo,
                    buscandoPaciente,
                    cargandoHorarios,
                    cargando,
                    errorPaciente,
                    mostrarNotificacion,

                    // Datos
                    serviciosDisponibles,
                    medicosDisponibles,
                    horariosDisponibles,

                    // Computed
                    nroDocumentoFormateado,
                    diasSemana,
                    horariosFiltrados,
                    nombreEspecialidadSeleccionada,
                    mostrarResumen,

                    // Métodos
                    agregarNumero,
                    limpiarUltimo,
                    limpiarTodo,
                    buscarPaciente,
                    buscarMedicos,
                    buscarHorarios,
                    seleccionarFecha,
                    seleccionarHorario,
                    formatearFecha,
                    formatHora,
                    confirmarCita,
                    limpiarFormulario,
                    cerrarNotificacion
                };
            }
        }).mount('#app');
    </script>
</body>
</html>